<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Harvester Highlights — Editor</title>
<style>
  :root{--bg:#0b0e13;--card:#151a22;--muted:#91a0b6;--text:#eaf0ff;--accent:#9dd2ff;--ring:#2b364c;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  header{padding:20px} h1{margin:0 0 6px} .meta{color:var(--muted);font-size:13px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:0 20px 16px}
  .toolbar select,.toolbar button{background:#0f131a;border:1px solid var(--ring);color:var(--text);padding:8px 10px;border-radius:10px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px;padding:0 20px 40px;max-width:1200px;margin:0 auto}
  .card{background:var(--card);border:1px solid var(--ring);border-radius:18px;padding:14px;display:flex;flex-direction:column;gap:10px}
  label{font-size:12px;color:var(--muted)} input,textarea{width:100%;background:#0f131a;color:var(--text);border:1px solid var(--ring);border-radius:10px;padding:8px}
  .row{display:flex;gap:8px} .row > *{flex:1} .muted{color:var(--muted)} .err{margin:0 20px 16px;background:#2a0f16;color:#ffd8de;border:1px solid #c74a5a;padding:10px;border-radius:10px}
</style>
</head>
<body>
<header>
  <h1>Harvester Highlights — Editor</h1>
  <div id="meta" class="meta"></div>
</header>

<div class="toolbar">
  <label for="citySelect" class="muted">Dataset:</label>
  <select id="citySelect">
    <option value="ca">Canada (combined)</option>
    <option value="yvr">YVR — Vancouver</option>
    <option value="yyz">YYZ — Toronto</option>
    <option value="yul">YUL — Montréal</option>
    <option value="yeg">YEG — Edmonton</option>
    <option value="yyc">YYC — Calgary</option>
  </select>

  <button id="regenBtn">Regenerate dataset timestamp</button>
  <button id="reloadBtn">Reload dataset</button>
  <button id="downloadBtn">Download JSON</button>
  <button id="splitBtn">Split combined → per-city</button>
  <span class="muted">•</span>
  <a href="/" style="color:var(--accent)">View site</a>
</div>

<div id="error" class="err" style="display:none"></div>
<main id="grid" class="grid" aria-live="polite"></main>

<script>
  // ---- params / dataset url
  const allow = ['ca','yvr','yyz','yul','yeg','yyc'];
  const paramCity = () => {
    const qs = new URLSearchParams(location.search);
    const c = (qs.get('city')||'ca').toLowerCase();
    return allow.includes(c) ? c : 'ca';
  };
  const buildUrl = () => `/highlights.${paramCity()}.json?nocache=${Date.now()}`;

  // ---- helpers
  const $ = id => document.getElementById(id);
  const fmtDate = iso => (!iso ? '—' : (/^\d{4}-\d{2}-\d{2}$/.test(String(iso)) ? iso : new Date(iso).toISOString().slice(0,10)));
  const nowISO = () => new Date().toISOString();

  /
